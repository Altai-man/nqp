# This is the JS Makefile - autogenerated by gen-makefile.nqp
JS_BUILD_DIR = gen/js
JS_STAGE1 = $(JS_BUILD_DIR)/stage1
JS_STAGE2 = $(JS_BUILD_DIR)/stage2
JS_NQP = ./$(M_RUNNER)$(BAT)
js-runner-default: js-all
$(JS_STAGE1)/QAST/Compiler.moarvm: src/vm/js/QAST/Compiler.nqp
	$(MKPATH) $(JS_STAGE1)/QAST
	$(JS_NQP) --module-path=$(JS_STAGE1) --target=mbc --output=$(JS_STAGE1)/QAST/Compiler.moarvm src/vm/js/QAST/Compiler.nqp
	$(MKPATH) gen/moar/stage2/QAST
	$(CP) $(JS_STAGE1)/QAST/Compiler.moarvm gen/moar/stage2/QAST/Compiler.moarvm

$(JS_STAGE1)/HLL/Backend.moarvm: src/vm/js/HLL/Backend.nqp $(JS_STAGE1)/QAST/Compiler.moarvm
	$(MKPATH) $(JS_STAGE1)/HLL
	$(JS_NQP) --module-path=$(JS_STAGE1) --target=mbc --output=$(JS_STAGE1)/HLL/Backend.moarvm src/vm/js/HLL/Backend.nqp
	$(MKPATH) gen/moar/stage2/HLL
	$(CP) $(JS_STAGE1)/HLL/Backend.moarvm gen/moar/stage2/HLL/Backend.moarvm

JS_STAGE1_COMPILER = $(JS_STAGE1)/QAST/Compiler.moarvm $(JS_STAGE1)/HLL/Backend.moarvm
$(JS_STAGE2)/$(NQP_MO_COMBINED): $(NQP_MO_SOURCES)
	$(MKPATH) $(JS_STAGE2)
	
	$(PERL) tools/build/gen-cat.pl js $(NQP_MO_SOURCES)  > $(JS_STAGE2)/$(NQP_MO_COMBINED)

$(JS_STAGE2)/nqpmo.moarvm: $(JS_STAGE1_COMPILER) $(JS_STAGE2)/$(NQP_MO_COMBINED)
	$(MKPATH) $(JS_STAGE2)
	$(JS_NQP) --module-path gen/js/stage1 src/vm/js/bin/cross-compile.nqp --setting=NULL --target=mbc --output $(JS_STAGE2)/nqpmo.moarvm $(JS_STAGE2)/$(NQP_MO_COMBINED) > node_modules/nqpmo.js

$(JS_STAGE2)/$(CORE_SETTING_COMBINED).nqp: $(CORE_SETTING_SOURCES)
	$(MKPATH) $(JS_STAGE2)
	
	$(PERL) tools/build/gen-cat.pl js $(CORE_SETTING_SOURCES)  > $(JS_STAGE2)/$(CORE_SETTING_COMBINED).nqp

$(JS_STAGE2)/NQPCORE.setting.moarvm: $(JS_STAGE1_COMPILER) $(JS_STAGE2)/$(CORE_SETTING_COMBINED).nqp $(JS_STAGE2)/nqpmo.moarvm
	$(MKPATH) $(JS_STAGE2)
	$(JS_NQP) --module-path gen/js/stage1 src/vm/js/bin/cross-compile.nqp --setting=NULL --target=mbc --output $(JS_STAGE2)/NQPCORE.setting.moarvm $(JS_STAGE2)/$(CORE_SETTING_COMBINED).nqp > node_modules/NQPCORE.setting.js

$(JS_STAGE2)/$(QASTNODE_COMBINED): $(QASTNODE_SOURCES)
	$(MKPATH) $(JS_STAGE2)
	
	$(PERL) tools/build/gen-cat.pl js $(QASTNODE_SOURCES)  > $(JS_STAGE2)/$(QASTNODE_COMBINED)

$(JS_STAGE2)/QASTNode.moarvm: $(JS_STAGE1_COMPILER) $(JS_STAGE2)/$(QASTNODE_COMBINED) $(JS_STAGE2)/NQPCORE.setting.moarvm
	$(MKPATH) $(JS_STAGE2)
	$(JS_NQP) --module-path gen/js/stage1 src/vm/js/bin/cross-compile.nqp --setting=NQPCORE --target=mbc --output $(JS_STAGE2)/QASTNode.moarvm $(JS_STAGE2)/$(QASTNODE_COMBINED) > node_modules/QASTNode.js

$(JS_STAGE2)/$(QREGEX_COMBINED): $(QREGEX_SOURCES)
	$(MKPATH) $(JS_STAGE2)
	
	$(PERL) tools/build/gen-cat.pl js $(QREGEX_SOURCES)  > $(JS_STAGE2)/$(QREGEX_COMBINED)

$(JS_STAGE2)/QRegex.moarvm: $(JS_STAGE1_COMPILER) $(JS_STAGE2)/$(QREGEX_COMBINED) $(JS_STAGE2)/NQPCORE.setting.moarvm $(JS_STAGE2)/QASTNode.moarvm
	$(MKPATH) $(JS_STAGE2)
	$(JS_NQP) --module-path gen/js/stage1 src/vm/js/bin/cross-compile.nqp --setting=NQPCORE --target=mbc --output $(JS_STAGE2)/QRegex.moarvm $(JS_STAGE2)/$(QREGEX_COMBINED) > node_modules/QRegex.js

js-stage1-compiler : $(JS_STAGE1_COMPILER)
js-test: js-all
	src/vm/js/bin/run_tests


js-clean:
	$(RM_RF) gen/js/stage1 gen/js/stage2

js-all : m-all js-stage1-compiler node_modules/installed $(JS_STAGE2)/NQPCORE.setting.moarvm $(JS_STAGE2)/$(CORE_SETTING_COMBINED).nqp $(JS_STAGE2)/QASTNode.moarvm $(JS_STAGE2)/QRegex.moarvm
js-lint:
	gjslint --strict --nojsdoc src/vm/js/nqp-runtime/*.js
node_modules/installed: src/vm/js/nqp-runtime/*.js src/vm/js/nqp-runtime/package.json
	npm install src/vm/js/nqp-runtime
	touch node_modules/installed

js-install: js-all
	@echo "*** The JavaScript backend can't be installed yet, sorry! ***"
